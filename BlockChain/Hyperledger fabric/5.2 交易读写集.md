### 交易流程

* 交易模拟：在背书节点执行，最终返回交易读写集（RWSet）。读写集告诉区块链在该笔交易中读操作了哪些数据（增删改查）。
* 交易排序
* 交易验证：即状态更新，更新内容是读写集中的写集

### 交易读写集（RWSet）

* 读集：读取**已提交**的状态键（值），已提交是指当前区块高度以前的数据，即已被网络认可的，不可再更改的数据（防止分叉）。

* 写集分为三种类型：

  * 写入新的键值对（增）。
  * 更新已存在的键值对（改）。
  * 为状态键值对添加删除标记（删）。

  如果在一次交易中对同一个键值对进行了多次修改，在最终的交易读写集中只会保留最后一次修改的结果。

* 版本号：由区块高度、交易编号组成的二元组，用于版本管理。

交易读写集在交易模拟执行后生成，交易排序过程不对交易读写集做任何操作。

### 交易验证

交易验证阶段除了验证签名、权限，还会验证读写集。验证交易读写集，即验证读集版本号是否与世界状态版本号一致，包括该笔交易以前**未提交的前序交易**，交易验证只验证读集而不验证写集。

### 交易模拟与交易验证举例

假设当前世界状态为：(k1, 1, v1) (k2, 1, v2) (k3, 1, v3) (k4, 1, v4)。=> (key, version, value)

交易1：Write (k1, v1'), Write (k2, v2')，该笔交易对 k1, k2 两个键值对进行更新，而没有进行读操作，因此这笔交易是有效的。

交易2：Read (k1), Write (k3, v3')，该笔交易对 k1 进行了读操作，而 k1 已在此前未提交的交易 1中被修改了，因此交易 2无效。

交易3：Write (k2, v2'')，该笔交易没有读操作，因此交易是有效的。

交易4：Write (k2, v2'''), Read (k3)，k3 在交易 2中被修改，当交易 2为无效交易，因此交易 4 是有效的。

交易5：Write (k5, v5), Read(k4)，该笔交易读取了 k4，而 k4 在之前的交易中未被修改，因此该笔交易有效。

