### 进入工作路径

```bash
cd $GOPATH/src/github.com/hyperledger/fabric/fabric-samples/romengine/deploy
```

### 设置工作路径

```bash
export FABRIC_CFG_PATH=$GOPATH/src/github.com/hyperledger/fabric/fabric-samples/romengine/deploy/configtx
```

### 环境清理

```bash
rm -Rf organizations/peerOrganizations && rm -Rf organizations/ordererOrganizations
```

### 生成证书文件

```bash
cryptogen generate --config=./organizations/cryptogen/crypto-config-org1.yaml --output="organizations"
cryptogen generate --config=./organizations/cryptogen/crypto-config-org2.yaml --output="organizations"
cryptogen generate --config=./organizations/cryptogen/crypto-config-orderer.yaml --output="organizations"
```

### 生成创世区块

```bash
configtxgen -profile TwoOrgsOrdererGenesis -channelID system-channel -outputBlock ./config/genesis.block
```

### 生成通道的创世交易

```bash
configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./config/tenant.tx -channelID tenant
```

### 生成组织锚节点（主节点）交易

```bash
configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./config/<组织MSP>anchors.tx -channelID tenant -asOrg <组织MSP>
```



---

执行以下命令进入 cli ：

```bash
docker exec -it cli bash
```

↓↓↓↓↓↓

### 创建通道

```bash
peer channel create -o orderer.romengine.com:7050 -c tenant -f /opt/gopath/src/github.com/hyperledger/fabric/config/tenant.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/romengine.com/orderers/orderer.romengine.com/msp/tlscacerts/tlsca.romengine.com-cert.pem --outputBlock /opt/gopath/src/github.com/hyperledger/fabric/config/tenant.block
```

> `-o` 选项指定与哪个 orderer 进行通信
>
> `-c` 通道名称
>
> `-f` 指定创世交易
>
> `--outputBlock` 产生通道创世区块



### 加入通道

```bash
peer channel join -b /opt/gopath/src/github.com/hyperledger/fabric/config/tenant.block
```

> `-b` 指定通道创世区块，创世区块在创建通道时生成

### 设置主节点

```bash
peer channel update -o orderer.romengine.com:7050 -c tenant -f /opt/gopath/src/github.com/hyperledger/fabric/config/Org1MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/romengine.com/orderers/orderer.romengine.com/msp/tlscacerts/tlsca.romengine.com-cert.pem
```

> 即设置某组织于某通道的主节点。

### 链码实例化

Fabric 2.0 的智能合约需要打包成一个 `.tar.gz` 压缩包。
打开控制台，执行 `docker exec -it cli` 进入 cli 容器

由于没接触过新的智能合约命令，我们先输入 `help`，获取下帮助文档，控制台输入：

```bash
peer lifecycle chaincode --help
```

`peer lifecycle chaincode` 命令定义说明：

```bash
# 智能合约所有操作命令：
Perform chaincode operations: package|install|queryinstalled|getinstalledpackage|approveformyorg|checkcommitreadiness|commit|querycommitted

Usage:
  peer lifecycle chaincode [command]

Available Commands:
  approveformyorg      # 同意智能合约定义
  checkcommitreadiness # 检查合约是否在通道上已经定义
  commit               # 提交合约定义到指定通道
  getinstalledpackage  # 从节点中获取已经安装的链码包
  install              # 部署链码
  package              # 打包链码
  querycommitted       # 查询节点上已提交的链码定义
  queryinstalled       # 查询节点已经安装的链码
```



### 链码交互

### 链码升级